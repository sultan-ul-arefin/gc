(window.webpackJsonp=window.webpackJsonp||[]).push([[22],{nX7e:function(e,t,r){"use strict";r.r(t);var o=r("ofXK"),a=r("tyNb"),l=r("mrSG"),c=r("wd/R"),s=r("fXoL"),i=r("H+bZ"),n=r("2Rin"),m=r("c14U");function d(e,t){if(1&e&&(s["\u0275\u0275elementStart"](0,"h2"),s["\u0275\u0275text"](1),s["\u0275\u0275elementEnd"]()),2&e){const e=s["\u0275\u0275nextContext"]();s["\u0275\u0275advance"](1),s["\u0275\u0275textInterpolate1"](" ",e.util.translate("Transaction status is failure")," ")}}function g(e,t){if(1&e&&(s["\u0275\u0275elementStart"](0,"h2"),s["\u0275\u0275text"](1),s["\u0275\u0275elementEnd"]()),2&e){const e=s["\u0275\u0275nextContext"]();s["\u0275\u0275advance"](1),s["\u0275\u0275textInterpolate1"](" ",e.util.translate("Your payment was successful done, thank you for purchase.")," ")}}const u=[{path:"",component:(()=>{class e{constructor(e,t,r,o,a){this.route=e,this.api=t,this.util=r,this.cart=o,this.router=a,this.route.queryParams.subscribe(e=>{console.log(e),this.status=e.status,e&&"success"===e.status?(e=>{try{return JSON.parse(e),!0}catch(t){return!1}})(localStorage.getItem("cartItems"))?(this.cart.cart=JSON.parse(localStorage.getItem("cartItems")),this.cart.deliveryAt=localStorage.getItem("deliveryAt"),this.cart.datetime=localStorage.getItem("datetime"),this.cart.totalPrice=localStorage.getItem("totalPrice"),this.cart.orderTax=localStorage.getItem("orderTax"),this.cart.grandTotal=localStorage.getItem("grandTotal"),this.cart.deliveryPrice=localStorage.getItem("deliveryPrice"),this.cart.coupon=(e=>{try{return JSON.parse(e),!0}catch(t){return!1}})(localStorage.getItem("appliedCoupon"))?JSON.parse(localStorage.getItem("appliedCoupon")):null,this.cart.userOrderTaxByStores=(e=>{try{return JSON.parse(e),!0}catch(t){return!1}})(localStorage.getItem("userOrderTaxByStores"))?JSON.parse(localStorage.getItem("userOrderTaxByStores")):[],this.cart.deliveryAddress=(e=>{try{return JSON.parse(e),!0}catch(t){return!1}})(localStorage.getItem("selectedAddress"))?JSON.parse(localStorage.getItem("selectedAddress")):null,this.cart.discount=localStorage.getItem("discount"),console.log("cart instance calcuatelllll,,,,,",this.cart),this.createOrder("paytm",localStorage.getItem("payTMOrderID"))):(console.log("somerthing went wrong"),localStorage.removeItem("cartItems"),localStorage.removeItem("deliveryAt"),localStorage.removeItem("datetime"),localStorage.removeItem("totalPrice"),localStorage.removeItem("orderTax"),localStorage.removeItem("grandTotal"),localStorage.removeItem("deliveryPrice"),localStorage.removeItem("appliedCoupon"),localStorage.removeItem("userOrderTaxByStores"),localStorage.removeItem("discount"),localStorage.removeItem("selectedAddress"),this.util.errorMessage(this.util.translate("Something went wrong"))):(localStorage.removeItem("cartItems"),localStorage.removeItem("deliveryAt"),localStorage.removeItem("datetime"),localStorage.removeItem("totalPrice"),localStorage.removeItem("orderTax"),localStorage.removeItem("grandTotal"),localStorage.removeItem("deliveryPrice"),localStorage.removeItem("appliedCoupon"),localStorage.removeItem("userOrderTaxByStores"),localStorage.removeItem("discount"),localStorage.removeItem("selectedAddress"),this.util.errorMessage(this.util.translate("Something went wrong")),this.router.navigate([""]))})}createOrder(e,t){return Object(l.a)(this,void 0,void 0,(function*(){const r=[...new Set(this.cart.cart.map(e=>e.store_id))],o=[];r.forEach(e=>{o.push({id:e,status:"created"})});const a=[{status:1,value:"Order Created",time:c().format("lll")}];this.cart.deliveryAt=this.cart.deliveryAt?this.cart.deliveryAt:"";const l={uid:localStorage.getItem("uid"),store_id:r.join(),date_time:"today"===this.cart.datetime?c().format("YYYY-MM-DD HH:mm:ss"):c().add(1,"days").format("YYYY-MM-DD HH:mm:ss"),paid_method:e,order_to:this.cart.deliveryAt,orders:JSON.stringify(this.cart.cart),notes:JSON.stringify(a),address:"home"===this.cart.deliveryAt?JSON.stringify(this.cart.deliveryAddress):"",driver_id:"",total:this.cart.totalPrice,tax:this.cart.orderTax,grand_total:this.cart.grandTotal,delivery_charge:this.cart.deliveryPrice,coupon_code:this.cart.coupon?JSON.stringify(this.cart.coupon):"",discount:this.cart.discount,pay_key:t,status:JSON.stringify(o),assignee:"",extra:JSON.stringify(this.cart.userOrderTaxByStores)};console.log("param-----\x3e",l),this.util.start(),this.api.post("orders/save",l).then(e=>{console.log(e),this.util.stop(),this.api.createOrderNotification(this.cart.stores),localStorage.removeItem("cartItems"),localStorage.removeItem("deliveryAt"),localStorage.removeItem("datetime"),localStorage.removeItem("totalPrice"),localStorage.removeItem("orderTax"),localStorage.removeItem("grandTotal"),localStorage.removeItem("deliveryPrice"),localStorage.removeItem("appliedCoupon"),localStorage.removeItem("userOrderTaxByStores"),localStorage.removeItem("discount"),localStorage.removeItem("selectedAddress"),this.cart.clearCart(),this.util.publishNewOrder();const t=(this.util.userInfo.first_name+"-"+this.util.userInfo.last_name).toLowerCase();this.router.navigate(["user",t,"order"])},e=>{console.log(e),localStorage.removeItem("cartItems"),localStorage.removeItem("deliveryAt"),localStorage.removeItem("datetime"),localStorage.removeItem("totalPrice"),localStorage.removeItem("orderTax"),localStorage.removeItem("grandTotal"),localStorage.removeItem("deliveryPrice"),localStorage.removeItem("appliedCoupon"),localStorage.removeItem("userOrderTaxByStores"),localStorage.removeItem("discount"),this.util.stop(),this.util.errorMessage(this.util.translate("Something went wrong"))}).catch(e=>{console.log(e),localStorage.removeItem("cartItems"),localStorage.removeItem("deliveryAt"),localStorage.removeItem("datetime"),localStorage.removeItem("totalPrice"),localStorage.removeItem("orderTax"),localStorage.removeItem("grandTotal"),localStorage.removeItem("deliveryPrice"),localStorage.removeItem("appliedCoupon"),localStorage.removeItem("userOrderTaxByStores"),localStorage.removeItem("discount"),localStorage.removeItem("selectedAddress"),this.util.stop(),this.util.errorMessage(this.util.translate("Something went wrong"))})}))}ngOnInit(){}}return e.\u0275fac=function(t){return new(t||e)(s["\u0275\u0275directiveInject"](a.a),s["\u0275\u0275directiveInject"](i.a),s["\u0275\u0275directiveInject"](n.a),s["\u0275\u0275directiveInject"](m.a),s["\u0275\u0275directiveInject"](a.f))},e.\u0275cmp=s["\u0275\u0275defineComponent"]({type:e,selectors:[["app-paytmcallback"]],decls:4,vars:2,consts:[[1,"container"],[1,"centered"],[4,"ngIf"]],template:function(e,t){1&e&&(s["\u0275\u0275elementStart"](0,"div",0),s["\u0275\u0275elementStart"](1,"div",1),s["\u0275\u0275template"](2,d,2,1,"h2",2),s["\u0275\u0275template"](3,g,2,1,"h2",2),s["\u0275\u0275elementEnd"](),s["\u0275\u0275elementEnd"]()),2&e&&(s["\u0275\u0275advance"](2),s["\u0275\u0275property"]("ngIf","failure"===t.status),s["\u0275\u0275advance"](1),s["\u0275\u0275property"]("ngIf","success"===t.status))},directives:[o.NgIf],styles:[".centered[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center}"]}),e})()}];let S=(()=>{class e{}return e.\u0275mod=s["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=s["\u0275\u0275defineInjector"]({factory:function(t){return new(t||e)},imports:[[a.h.forChild(u)],a.h]}),e})();r.d(t,"PaytmcallbackModule",(function(){return v}));let v=(()=>{class e{}return e.\u0275mod=s["\u0275\u0275defineNgModule"]({type:e}),e.\u0275inj=s["\u0275\u0275defineInjector"]({factory:function(t){return new(t||e)},imports:[[o.CommonModule,S]]}),e})()}}]);